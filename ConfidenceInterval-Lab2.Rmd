---
title: 'Lab 2: Confidence Interval'
author: "Nolwenn Le Meur & Pascal Crepey"
date: "September, 27-28 2016"
output: pdf_document
---

```{r include=FALSE}
knitr::opts_chunk$set(eval=F, echo=F)
solution <- FALSE
```

```{r correction, eval=T, echo=F, include=F}
#Color Format
colFmt = function(x,color){
  outputFormat = knitr::opts_knit$get("rmarkdown.pandoc.to")
  if(outputFormat == 'latex')
    paste("\\textcolor{",color,"}{",x,"}",sep="")
  else if(outputFormat == 'html')
    paste("<font color='",color,"'>",x,"</font>",sep="")
  else
    x
}
```


Objectives:

* Interpret confidence interval of a mean or proportion
* Compute and plot confidence interval of a mean or proportion

You are interest in risk factors associated with low infant birth weight. You are given the  _birthwt_ dataset, which is composed of 189 women (rows) and 10 variables (columns). The data were collected at Baystate Medical Center, Springfield, Mass during 1986. 

1. Is it an exhaustive collection?
2. Are we representative ? Justify.

# 1. Distribution of birth weight
The conclusion you will draw from your analysis will be at the population level, thus you need to describe the data in that sense. You want to estimate the TRUE mean of babys' weight at birth in your population of interest.

3. What should you compute?
4. What does the code below do? Make a sentence to explicit the results.

```{r ci load, echo=T, eval=T}
library(MASS)
data(birthwt)
```

```{r ci mean, echo=T}
mean(birthwt$bwt) - 1.96*sd(birthwt$bwt)/sqrt(189)
mean(birthwt$bwt) + 1.96*sd(birthwt$bwt)/sqrt(189)
```
`r if(solution){colFmt("After loading the birthw data, it computes the 95% confidence interval  where the TRUE mean of the unknown population would stands if the experiment was repeated. The right part of the equation represents the standard error (se). se is the estimated standard deviation of the unknown population.", "blue")}`

5. What does happen if 1.96 is replaced by 2.57? Are you more confident or more precise on your results?
6. What does the code below do?
```{r pnorm, echo=T}
pnorm(1.96)
pnorm(2.57)
```

```{r ci}
# For lazy/smart users:
# install epiDisplay library for good
# install.packages("epiDisplay")
# Loading library each time you want to use it
library(epiDisplay)
# compte 95% confidence interval
ci(birthwt$bwt, alpha=0.05)
# compte 99% confidence interval
ci(birthwt$bwt, alpha=0.01)
```

# 2. Proportion of smoking women
Next, you want to assess the proportion of smoking women in your population. 

7. Using the ci() function from the _epiDisplay_ package, compute the 95% confidence interval of the proportion of smoking women in the population. Make a sentence to explicit the results.
```{r load epidisplay, echo=F, eval = T, message=FALSE}
library(epiDisplay)
```

```{r ci binomial, message=FALSE}
ci(birthwt$smoke)
```

8. You wish you were more accurate in your estimation. When "your" statistician compute the sample size, he used the code below. According to his results you choose to study twice the number of women, thinking you would get a delta (precision) of 0.05. Were you right?
```{r ci n1, echo=T, message=FALSE}
n.for.survey(0.4, delta=0.1)
```

```{r ci n2, message=FALSE}
n.for.survey(0.4, delta=0.05)
```

9. From the previous lab session (section 5), you know that there seems to be differences in the distribution of smoking women between races. The code below computes and plots the 95% confidence interval of the proportion of smoking women by race group. Can you conclude on your hypotheses?
```{r ci race, echo=T, eval=T}
by(birthwt$smoke, birthwt$race , ci)
aggregate.plot(x=birthwt$smoke, by=list("Race"=birthwt$race), error="ci")
```

# Homework
10. As for the confidence interval of the mean baby's weight, try to compute 95% CI of the proportion of smoking women in the population, without the help of the ci() function but the formula from the course.
```{r ci proportion}
# get the proportion of smoking women
prop.table(table(birthwt$smoke))
0.39-1.96*sqrt((0.39*0.64)/189)
0.39+1.96*sqrt((0.39*0.64)/189)

## OR with mean(), it works here because smoke is a binary variable coded as integer in R
mean(birthwt$smoke)
mean(birthwt$smoke)+1.96*sqrt(mean(birthwt$smoke)*(1-mean(birthwt$smoke))/189)
mean(birthwt$smoke)-1.96*sqrt(mean(birthwt$smoke)*(1-mean(birthwt$smoke))/189)
```

